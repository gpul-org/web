---
import Loader from "lucide-astro/Loader";
import Check from "lucide-astro/Check";

const { class: className } = Astro.props;
---
<div class={`bg-gray-100 rounded-2xl p-8 m-auto h-fit ${className}`}>
  <h2 class="text-2xl font-bold text-gray-900 mb-6">Envíanos unha mensaxe</h2>
  
  <form id="contact-form" class="space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label for="nome" class="block text-sm font-medium text-gray-700 mb-1">Nome *</label>
        <input 
          type="text" 
          id="nome" 
          name="nome" 
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="O teu nome"
        />
      </div>
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
        <input 
          type="email" 
          id="email" 
          name="email" 
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="teu@email.com"
        />
      </div>
    </div>

    <div>
      <label for="asunto" class="block text-sm font-medium text-gray-700 mb-1">Asunto *</label>
      <select 
        id="asunto" 
        name="asunto"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
        <option value="">Selecciona un asunto</option>
        <option value="socio">Quero ser socio</option>
        <option value="evento">Consulta sobre eventos</option>
        <option value="colaboracion">Proposta de colaboración</option>
        <option value="charla">Propor charla/taller</option>
        <option value="outro">Outro</option>
      </select>
    </div>

    <div>
      <label for="mensaxe" class="block text-sm font-medium text-gray-700 mb-1">Mensaxe *</label>
      <textarea 
        id="mensaxe" 
        name="mensaxe" 
        rows="5" 
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        placeholder="Escribe aquí a túa mensaxe..."
      ></textarea>
    </div>

    <div class="flex items-start">
      <div class="flex items-center h-5">
        <input 
          id="privacidade" 
          name="privacidade" 
          type="checkbox" 
          required
          class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"
        />
      </div>
      <div class="ml-3 text-sm">
        <label for="privacidade" class="text-gray-700">
          Acepto a <a href="#" class="text-blue-600 hover:text-blue-700">política de privacidade</a> *
        </label>
      </div>
    </div>

    <button 
      type="submit"
      class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium flex justify-center gap-4"
    >
      Enviar mensaxe
      <Loader class="loader hidden"/>
      <Check class="check hidden "/>
    </button>
  </form>
  <script defer>

    const form = document.querySelector('#contact-form');
    const loader = form.querySelector('.loader')
    const check = form.querySelector('.check')
  
    form.addEventListener('submit', async event => {
      event.preventDefault();

      startLoad()

      try {
        const response = await fetch("https://activepieces.gpul.org/api/v1/webhooks/0c0o5NPbtpg4ddEjWiD3p", {
          method: "POST",
          body: new FormData(form),
        })
      } catch (error) {
        console.error(error);
      }

      endLoad()

    })

    function startLoad() {
      loader.classList.remove("hidden")
      loader.classList.add("animate-spin")
    }

    function endLoad() {
      loader.classList.add("hidden")
      loader.classList.remove("animate-spin")

      check.classList.remove("hidden")
      check.classList.add("animate-bounce")
      setTimeout(() => check.classList.add("hidden"), 500)
    }

  </script>
</div>
